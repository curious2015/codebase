# Шлюз
Необходимо сделать возможность ввода и вывода ETH из Ethereum в graphene и обратно. Допустим, у нас есть свой DEX на graphene, тогда задача сводится к эмиссии билетика на получение ETH на аккаунт пользователя при вводе средств и сжигании этого билетика при выводе средств. Для примера назовем этот билетик gate.ETH. В целях обеспечения большего доверия шлюзу, эмиссия и сжигание билетиков должны производиться путем децентрализованного подтверждения данных операций.

## Ввод средств в DEX:
1. Пользователь заходит DEX GUI и нажимает на deposit, для него генерируется персональный адрес к ETH кошельку шлюза и input data (имя аккаунта пользователя в DEX в необходимом формате) для указания при переводе средств на кошелек шлюза. Адрес хранится в браузере у пользователя.
2. Пользователь заходит на Ethereum и переводит нужный объем ETH, используя вдрес и input data, полученные на предыдущем шаге.
3. После перевода ETH пользователь в DEX GUI нажимает на claim gate.ETH. Пользователя предупреждают о том, что не стоит отменять propose. Как только GUI находит транзакцию в Ethereum, он создает propose на эмиссию необходимой суммы gate.ETH на аккаунт пользователя в DEX от имени аккаунта пользователя с id транзакции Ethereum в memo. У пользователя должна быть возможность ввести адрес, полученный ранее, в случае его утраты между 2 и 3 шагами. После создания propose последним шагом у пользователя будет генерироваться новый адрес для ввода ETH в шлюз.
4. Скрипты-заверители проверяют propose заявки и транзакции в Ethereum и при корректности пар подтверждают эмиссию gate.ETH на аккаунт пользователя в DEX. Для подтверждения аккаунт пользователя получателя эмиссии в DEX должен совпадать с input data из транзакции, должны совпадать суммы (за вычетом нашей комсы), транзакция в Ethereum должна быть подтвержденной и транзакция должна быть не погашенной с точки зрения шлюза (ее не должно быть в предыдущих успешных propose пользователя в memo).

### Вопросы:
1. Как будет генерироваться адрес в Ethereum?
2. Как будут удаляться ненужные адреса и будут ли? Есть ли лимиты?
3. Можно ли получить id транзакции или номер блока в Ethereum?
4. Хватит ли id транзакции Ethereum в memo?
5. Нужно ли в GUI проверять данные перед созднанием propose?
6. Стоит ли сделать ограничение на claim? В течении суток на пример после перевода ETH.

### Задачи:
1. Проверить будут ли заверители видеть memo.
2. Проверить как работает ETH и какая информация там доступна по id транзакции/блока.

## Вывод средств из DEX:
1. Пользователь заходит DEX GUI и нажимает на вывод его gate.ETH, затем он вводит нужную сумму и адрес своего кошелька в Ethereum.
2. Осуществляется перевод нужной суммы gate.ETH на gate аккаунт и в memo указывается адес кошелька в Ethereum.
3. Бот burner парсит эту транзакцию, создает propose на сжигание gate.ETH, создает propose на перевод ETH на нужный кошелек по memo. Propose нужно связать с транзакцией через memo, иначе сложно будет их сопоставить друг другу.
4. Боты заверители сверяют транзакцию с двумя propose и подтверждают их, если все сходится. Сходиться должны суммы (за вычетом комиссии) и адрес с memo. Сперва нужно подтверждать propose на перевод ETH, затем на сжигание gate.ETH.

### Вопросы:
1. Будет ли наша комса на выводе или только вычет комсы за перевод ETH?
2. Как отличить погашенные от не погашенных транзакций?
3. Можно сделать без бота, но чьими ключами делать propose в Ethereum и на чью комиссию?
4. Как связывать оба propose с транзакцией?

### Задачи:
1. Изучить propose в ETH. Он там точно есть.
2. Разобраться возможно ли отменить propose, если есть хоть одно подтверждение.

## Схема работы шлюза
[Открыть схему](https://www.draw.io/?lightbox=1&highlight=0000ff&edit=_blank&layers=1&nav=1&page=1&title=Gate.xml#Uhttps%3A%2F%2Fraw.githubusercontent.com%2Fu-transnet%2Fcodebase%2Fgate%2FGate%2520UTT%2520-%2520ETH%2FGate.xml)

## Технологии
[python-bitshares](https://github.com/xeroc/python-bitshares)  
[bitsharesjs](https://github.com/bitshares/bitsharesjs)  
[pyethapp](https://github.com/ethereum/pyethapp/wiki/The_Console)  
